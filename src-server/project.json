{
  "name": "server",
  "$schema": "../node_modules/nx/schemas/project-schema.json",
  "projectType": "application",
  "sourceRoot": "src-server",
  "targets": {
    "install": {
      "command": "uv sync --all-groups",
      "cache": true,
      "inputs": [
        "{projectRoot}/pyproject.toml",
        "{projectRoot}/uv.lock"
      ]
    },
    "test": {
      "command": "uv run pytest",
      "dependsOn": [
        "install"
      ]
    },
    "dev": {
      "command": "uv run python -m scripts.watches dev",
      "continuous": true,
      "dependsOn": [
        "install",
        "watch-schema"
      ]
    },
    "watch-schema": {
      "command": "uv run python -m scripts.watches schema",
      "continuous": true,
      "dependsOn": [
        "install"
      ],
      "outputs": [
        "{workspaceRoot}/openapi.json"
      ]
    },
    "build": {
      "executor": "nx:run-commands",
      "dependsOn": [
        "install",
        {
          "target": "build",
          "projects": [
            "frontend"
          ]
        }
      ],
      "cache": true,
      "options": {
        "commands": [
          "uv run pyinstaller --noconfirm --name server entry.py",
          "uv run python -m scripts.rename_python_sidecar --name=server --output-dir=../src-tauri/"
        ],
        "parallel": false
      },
      "inputs": [
        "{projectRoot}/**/*.py",
        "{projectRoot}/pyproject.toml"
      ],
      "outputs": [
        "{projectRoot}/dist",
        "{workspaceRoot}/src-tauri/server*"
      ]
    },
    "export-openapi": {
      "command": "uv run python -m scripts.export_openapi",
      "cache": true,
      "inputs": [
        "{projectRoot}/src/api/**/*.py"
      ],
      "outputs": [
        "{workspaceRoot}/openapi.json"
      ]
    },
    "generate-migration": {
      "executor": "nx:run-commands",
      "dependsOn": [
        "install"
      ],
      "options": {
        "commands": [
          "uv run alembic upgrade head",
          "uv run alembic revision --autogenerate"
        ],
        "parallel": false,
        "cwd": "src-server"
      }
    }
  }
}